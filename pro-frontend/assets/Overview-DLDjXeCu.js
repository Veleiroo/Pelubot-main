import{j as e}from"./ui-vendor-DjtdC3iZ.js";import{r as o}from"./react-vendor-DWrzsp0o.js";import{c as K,e as E,B as y,X as J,u as W,f as Z,L as ee}from"./index-CX6e3e6v.js";import{u as se}from"./pro-BLrhzhxu.js";import{C as P}from"./card-SJHWFEUi.js";import{S as I}from"./skeleton-BQs0x_V-.js";import{C as Q}from"./clock-LR5DpgLS.js";import{P as z,D as ae,a as te,b as re,c as ie,d as ne,M as de,e as le,T as ce}from"./dialog-otDeU54W.js";import{C as V}from"./calendar-7ygCif2F.js";import{C as B,U as oe}from"./user-9509D_2P.js";import{u as R}from"./useQuery-CdrMCFj5.js";import{I as O}from"./input-BYXIM_YD.js";import{L as _}from"./label-JnwPont5.js";import{T as me}from"./textarea-BOvA95EP.js";import{a as D}from"./api-PPFfqhN_.js";import{S as ue}from"./scissors-d8NSnT0-.js";import{u as q}from"./useMutation-CdoIIBws.js";import"./index-Dbmg-Ekv.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=K("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=K("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=K("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]),fe=s=>{if(!s)return null;const a=new Date(s);return Number.isNaN(a.getTime())?null:new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}).format(a)},ge=s=>{if(!s)return"--:--";const a=new Date(s);return Number.isNaN(a.getTime())?"--:--":new Intl.DateTimeFormat("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1}).format(a)},be={confirmada:"border border-amber-500/40 bg-amber-500/10 text-amber-600",asistida:"border border-emerald-500/40 bg-emerald-500/10 text-emerald-600",no_asistida:"border border-red-500/40 bg-red-500/10 text-red-600",cancelada:"border border-rose-500/40 bg-rose-500/10 text-rose-600"},ve={confirmada:"bg-amber-500",asistida:"bg-emerald-500",no_asistida:"bg-red-500",cancelada:"bg-rose-500"},Ne={confirmada:"Pendiente",asistida:"Asistida",no_asistida:"No asistida",cancelada:"Cancelada"},je=({appointment:s,isLoading:a,onAction:r})=>{const c=o.useMemo(()=>s!=null&&s.lastVisit?fe(s.lastVisit):null,[s]),l=s?be[s.status]:"";return e.jsxs(P,{className:"rounded-xl border border-border/50 bg-card p-6 shadow-xl transition-all duration-300 hover:-translate-y-0.5 hover:shadow-2xl font-sans",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"mb-2 text-xs uppercase tracking-[0.28em] text-muted-foreground",children:"Próxima cita"}),e.jsx("h2",{className:"mb-3 text-3xl font-semibold text-foreground",children:a?e.jsx(I,{className:"h-8 w-1/2"}):(s==null?void 0:s.client)??"Sin citas programadas"}),s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2 text-base text-muted-foreground",children:[e.jsx(Q,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsxs("span",{className:"font-semibold text-foreground",children:[s.time," h"]}),e.jsx("span",{children:"•"}),e.jsxs("div",{className:E("flex items-center gap-1.5 rounded-full px-2.5 py-0.5 text-[11px] font-medium shadow-sm backdrop-blur",l),children:[e.jsx("div",{className:E("h-1.5 w-1.5 rounded-full",ve[s.status])}),e.jsx("span",{children:Ne[s.status]})]})]}),e.jsx("p",{className:"mb-4 text-base text-muted-foreground",children:s.service}),e.jsxs("div",{className:"space-y-1.5 text-sm text-muted-foreground",children:[s.phone?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:s.phone})]}):null,c?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsxs("span",{children:["Última visita: ",c]})]}):null]}),s.notes?e.jsx("p",{className:"mt-3 border-l-2 border-border pl-3 text-sm italic text-muted-foreground",children:s.notes}):null]}):a?e.jsxs("div",{className:"space-y-3",children:[e.jsx(I,{className:"h-4 w-1/3"}),e.jsx(I,{className:"h-3 w-2/3"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"h-3 w-1/2"}),e.jsx(I,{className:"h-3 w-2/5"})]}),e.jsx(I,{className:"h-16 w-full"})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aprovecha el día libre para organizar tu agenda o contactar con tus clientes recurrentes."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(y,{size:"sm",className:"flex-1 h-9 gap-2 rounded-full px-4 text-sm font-semibold bg-accent text-accent-foreground transition hover:bg-accent/90",disabled:!s,onClick:()=>r("attended",s==null?void 0:s.id),children:[e.jsx(B,{className:"h-3.5 w-3.5"}),"Asistida"]}),e.jsxs(y,{size:"sm",variant:"outline",className:"flex-1 h-9 rounded-full px-4 text-sm font-semibold transition hover:bg-secondary/80",disabled:!s,onClick:()=>r("no-show",s==null?void 0:s.id),children:[e.jsx($,{className:"h-3.5 w-3.5"}),"No asistió"]}),e.jsxs(y,{size:"sm",variant:"outline",className:"flex-1 h-9 rounded-full px-4 text-sm font-semibold transition hover:bg-secondary/80",disabled:!s,onClick:()=>r("reschedule",s==null?void 0:s.id),children:[e.jsx(xe,{className:"h-3.5 w-3.5"}),"Mover"]})]})]})},ye=[{key:"confirmadas",label:"Pendientes",color:"bg-amber-500"},{key:"asistidas",label:"Asistidas",color:"bg-emerald-600"},{key:"no_asistidas",label:"No asistidas",color:"bg-red-500"}],pe=({summary:s,isLoading:a})=>e.jsxs(P,{className:"border border-border/50 bg-card p-5 shadow-xl font-sans",children:[e.jsx("h3",{className:"mb-1 text-xl font-semibold text-foreground",children:"Resumen del día"}),e.jsx("p",{className:"mb-4 text-sm text-muted-foreground",children:"Vista rápida de tu agenda hoy."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border border-border/60 bg-secondary/20 py-5 text-center shadow-inner",children:[e.jsx("p",{className:"mb-1 text-xs uppercase tracking-[0.24em] text-muted-foreground",children:"Total de citas"}),e.jsx("p",{className:"text-4xl font-bold text-foreground",children:a?"—":s.total})]}),ye.map(({key:r,label:c,color:l})=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-border/40 bg-secondary/20 px-3 py-2.5",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:c}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-semibold text-foreground",children:a?"—":s[r]}),e.jsx("span",{className:`h-2 w-2 rounded-full ${l}`})]})]},r))]})]}),we=["09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30"],Se=s=>{if(!s)return"";const a=new Date(s);return Number.isNaN(a.getTime())?"":a.toISOString().slice(0,10)},Ce=({open:s,onOpenChange:a,suggestedDate:r,suggestedService:c,onConfirm:l})=>{const[f,m]=o.useState(""),[t,n]=o.useState(""),[p,w]=o.useState(""),[u,g]=o.useState(""),[k,b]=o.useState(""),[i,x]=o.useState(""),[v,N]=o.useState(""),{data:j=[],isLoading:F}=R({queryKey:["services"],queryFn:D.getServices,staleTime:5*60*1e3}),M=j.find(d=>d.id===i),h=o.useMemo(()=>Se(r),[r]);o.useEffect(()=>{s?(m(h),x(c??""),g(""),b("")):(n(""),w(""),g(""),b(""),x(""),m(""),N(""))},[s,h,c]);const S=()=>a(!1),C=!p||!u||!f||!t||!i||!M,T=()=>{C||!M||(l==null||l({client:p,clientPhone:u,clientEmail:k||void 0,date:f,time:t,serviceId:i,serviceName:M.name,durationMinutes:M.duration_min,notes:v}),a(!1))};return e.jsx(ae,{open:s,onOpenChange:a,children:e.jsxs(te,{className:"max-h-[90vh] max-w-2xl overflow-y-auto border-border bg-card",children:[e.jsxs(re,{children:[e.jsx(ie,{className:"text-2xl font-bold",children:"Nueva cita"}),e.jsx(ne,{children:"Completa los detalles para crear una nueva cita en tu agenda."})]}),e.jsxs("div",{className:"mt-4 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{htmlFor:"client",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(oe,{className:"h-4 w-4","aria-hidden":"true"}),"Nombre del cliente *"]}),e.jsx(O,{id:"client",placeholder:"Nombre completo del cliente",value:p,onChange:d=>w(d.target.value),className:"border-border bg-secondary/50",required:!0})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{htmlFor:"client-phone",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(z,{className:"h-4 w-4","aria-hidden":"true"}),"Teléfono *"]}),e.jsx(O,{id:"client-phone",type:"tel",placeholder:"+34 600 000 000",value:u,onChange:d=>g(d.target.value),className:"border-border bg-secondary/50",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{htmlFor:"client-email",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(de,{className:"h-4 w-4","aria-hidden":"true"}),"Email"]}),e.jsx(O,{id:"client-email",type:"email",placeholder:"cliente@ejemplo.com",value:k,onChange:d=>b(d.target.value),className:"border-border bg-secondary/50"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{htmlFor:"date",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(V,{className:"h-4 w-4","aria-hidden":"true"}),"Fecha *"]}),e.jsx(O,{id:"date",type:"date",value:f,onChange:d=>m(d.target.value),className:"border-border bg-secondary/50",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Q,{className:"h-4 w-4","aria-hidden":"true"}),"Horario disponible"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-4 lg:grid-cols-6",children:we.map(d=>e.jsx(y,{type:"button",size:"sm",variant:t===d?"default":"outline",onClick:()=>n(d),className:E("bg-secondary/50 text-xs transition",t===d?"bg-accent text-accent-foreground hover:bg-accent/90":"hover:bg-secondary"),children:d},d))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ue,{className:"h-4 w-4","aria-hidden":"true"}),"Servicio *"]}),F?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cargando servicios..."}):j.length===0?e.jsx("div",{className:"text-sm text-destructive",children:"No hay servicios disponibles"}):e.jsx("div",{className:"space-y-2",children:j.map(d=>e.jsx(P,{role:"button",tabIndex:0,onClick:()=>x(d.id),onKeyDown:L=>{(L.key==="Enter"||L.key===" ")&&(L.preventDefault(),x(d.id))},className:E("cursor-pointer border-border bg-secondary/50 p-3 transition-all hover:bg-secondary hover:shadow-md focus:outline-none focus:ring-2 focus:ring-accent",i===d.id&&"border-accent bg-accent/20"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium",children:d.name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[d.price_eur,"€"]})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[d.duration_min," min"]})]})},d.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"notes",className:"text-sm font-medium",children:"Notas / Observaciones"}),e.jsx(me,{id:"notes",placeholder:"Preferencias del cliente, detalles especiales...",className:"min-h-[80px] border-border bg-secondary/50",value:v,onChange:d=>N(d.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-4 sm:flex-row",children:[e.jsx(y,{type:"button",className:"flex-1 bg-accent text-accent-foreground hover:bg-accent/90",disabled:C,onClick:T,children:"Crear cita"}),e.jsxs(y,{type:"button",variant:"outline",className:"flex-1 bg-transparent hover:bg-secondary",onClick:S,children:[e.jsx(J,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),"Cancelar"]})]})]})]})})},ke={confirmada:{label:"Pendiente",dot:"bg-amber-500",text:"text-amber-500"},asistida:{label:"Asistida",dot:"bg-emerald-600",text:"text-emerald-600"},no_asistida:{label:"No asistida",dot:"bg-red-500",text:"text-red-500"},cancelada:{label:"Cancelada",dot:"bg-rose-500",text:"text-rose-500"}},Ae=({appointments:s,summary:a,isLoading:r,errorMessage:c,onCreateAppointment:l,onAction:f,isProcessingAction:m=!1})=>{const[t,n]=o.useState(null),[p,w]=o.useState(null),u=o.useMemo(()=>({confirmadas:a.confirmadas,asistidas:a.asistidas,no_asistidas:a.no_asistidas,canceladas:a.canceladas}),[a]),g=i=>{n(x=>x===i?null:i)},k=(i,x)=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),g(x))},b=async(i,x)=>{if(!m)try{w(x);let v;if(i==="no-show"){const N=window.prompt("Motivo del no-show (opcional)");v=N&&N.trim()||void 0}await f(i,x,v),n(null)}finally{w(null)}};return e.jsxs(P,{className:"flex h-full flex-col border border-border/50 bg-card p-5 shadow-lg font-sans",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-semibold text-foreground",children:"Citas de hoy"}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-base text-muted-foreground",children:[e.jsxs("span",{children:[s.length," ",s.length===1?"cita":"citas"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{className:"text-amber-500",children:[u.confirmadas," pendientes"]}),u.asistidas>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"text-emerald-600",children:[u.asistidas," asistidas"]})]}),u.no_asistidas>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"text-red-500",children:[u.no_asistidas," no asistidas"]})]}),u.canceladas>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"text-destructive",children:[u.canceladas," canceladas"]})]})]})]}),e.jsxs(y,{size:"sm",onClick:l,className:"h-9 rounded-full px-4 text-sm font-semibold",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Crear cita"]})]}),r?e.jsx("div",{className:"flex flex-1 items-center justify-center rounded-lg bg-muted text-sm text-muted-foreground",children:"Cargando agenda..."}):c?e.jsx("div",{className:"flex flex-1 items-center justify-center rounded-lg bg-destructive/10 text-sm text-destructive",children:c}):e.jsx("div",{className:"flex-1 space-y-3 overflow-y-auto",children:s.length===0?e.jsxs("div",{className:"flex h-full min-h-[160px] flex-col items-center justify-center rounded-lg border border-dashed border-border/60 bg-secondary/30 p-6 text-center text-sm text-muted-foreground",children:[e.jsx("p",{className:"font-medium text-foreground",children:"No tienes citas programadas hoy."}),e.jsx("p",{className:"mt-1 text-xs",children:"Aprovecha para contactar con tus clientes o preparar tus próximos servicios."})]}):s.map((i,x)=>{const v=ke[i.status],N=t===i.id,j=m||p===i.id;return e.jsxs("div",{className:E("w-full rounded-lg border border-border/30 bg-secondary/30 p-4 transition-all duration-200","hover:-translate-y-0.5 hover:bg-secondary/50",N?"ring-2 ring-accent":"","animate-in fade-in slide-in-from-left-2"),style:{animationDelay:`${x*50}ms`},children:[e.jsxs("div",{role:"button",tabIndex:0,onClick:()=>g(i.id),onKeyDown:F=>k(F,i.id),className:"flex items-start justify-between gap-4 text-left",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"mb-1 flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Q,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{className:"font-semibold",children:i.time})]}),e.jsx("h3",{className:"mb-1 text-lg font-semibold text-foreground",children:i.client}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.service}),i.notes?e.jsx("p",{className:"mt-1 text-xs italic text-muted-foreground/80",children:i.notes}):null]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:E("h-1.5 w-1.5 rounded-full",v.dot)}),e.jsx("span",{className:E("text-xs font-medium",v.text),children:v.label})]})]}),N&&e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-3",children:[i.status!=="cancelada"&&e.jsxs(e.Fragment,{children:[e.jsxs(y,{size:"sm",className:"h-8 rounded-full px-3 text-xs font-semibold flex items-center gap-1.5 bg-emerald-500 text-emerald-950 hover:bg-emerald-400",disabled:j,onClick:()=>b("attended",i.id),children:[e.jsx(B,{className:"h-3.5 w-3.5"}),"Asistida"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(y,{size:"sm",variant:"outline",className:"h-8 rounded-full px-3 text-xs font-semibold flex items-center gap-1.5 border-amber-400/60 text-amber-500 hover:bg-amber-500/10",disabled:j,onClick:()=>b("no-show",i.id),children:[e.jsx($,{className:"h-3.5 w-3.5"}),"No asistió"]}),e.jsxs(y,{size:"sm",variant:"outline",className:"h-8 rounded-full px-3 text-xs font-semibold flex items-center gap-1.5 border-destructive/60 text-destructive hover:bg-destructive/10",disabled:j,onClick:()=>b("cancel",i.id),children:[e.jsx(ce,{className:"h-3.5 w-3.5"}),"Cancelar"]})]})]}),e.jsxs(y,{size:"sm",variant:"outline",className:"h-8 rounded-full px-3 text-xs font-semibold flex items-center gap-1.5 border-white/30 text-white hover:bg-white/10",disabled:j,onClick:()=>b("delete",i.id),children:[e.jsx(he,{className:"h-3.5 w-3.5"}),"Eliminar"]}),j&&e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Procesando acción…"})]})]},i.id)})})]})},_e=s=>s.reduce((a,r)=>(a.total+=1,r.status==="confirmada"&&(a.confirmadas+=1),r.status==="asistida"&&(a.asistidas+=1),r.status==="no_asistida"&&(a.no_asistidas+=1),r.status==="cancelada"&&(a.canceladas+=1),a),{total:0,confirmadas:0,asistidas:0,no_asistidas:0,canceladas:0}),De=s=>{const a=R({queryKey:["pros","overview"],queryFn:D.prosOverview,enabled:s,refetchInterval:6e4,retry:1}),r=a.data,c=o.useCallback(n=>({id:n.id,time:ge(n.start),client:n.client_name??"Reserva sin nombre",service:n.service_name??n.service_id??"Servicio por confirmar",status:n.status,phone:n.client_phone??void 0,lastVisit:n.last_visit??void 0,notes:n.notes??void 0,raw:n}),[]),l=o.useMemo(()=>r?r.appointments.map(c):[],[r,c]),f=o.useMemo(()=>r!=null&&r.upcoming?c(r.upcoming):l.find(n=>n.status!=="cancelada")??l[0]??null,[r,l,c]),m=o.useMemo(()=>r!=null&&r.summary?r.summary:_e(l),[r,l]),t=a.error??null;return{overview:r,appointments:l,upcomingAppointment:f,summary:m,isInitialOverviewLoading:a.isLoading&&!r,overviewErrorMessage:(t==null?void 0:t.message)??null,refetchOverview:a.refetch}},Ee=({professionalId:s})=>{const a=W(),r=q({mutationFn:async t=>{if(!s)throw new Error("No hay profesional activo para crear la reserva.");const n=await D.prosCreateReservation({service_id:t.serviceId,professional_id:s,start:t.startISO,customer_name:t.clientName,customer_phone:t.clientPhone,...t.clientEmail?{customer_email:t.clientEmail}:{},...t.notes?{notes:t.notes}:{}}),p={id:n.reservation_id,service_id:t.serviceId,service_name:t.serviceName,professional_id:s,start:t.startISO,end:t.endISO,status:"confirmada",customer_name:t.clientName,customer_phone:t.clientPhone,customer_email:t.clientEmail,notes:t.notes,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return{response:n,reservation:p}},onSuccess:({reservation:t})=>{a.setQueriesData({queryKey:["pros","reservations"]},n=>n&&{reservations:[...n.reservations.filter(u=>u.id!==t.id),t].sort((u,g)=>new Date(u.start).getTime()-new Date(g.start).getTime())}),a.invalidateQueries({queryKey:["pros","reservations"]}),a.invalidateQueries({queryKey:["pros","overview"]})}}),c=q({mutationFn:async t=>await D.prosMarkAttended(t),onSuccess:()=>{a.invalidateQueries({queryKey:["pros","overview"]}),a.invalidateQueries({queryKey:["pros","reservations"]})}}),l=q({mutationFn:async({appointmentId:t,reason:n})=>await D.prosMarkNoShow(t,n),onSuccess:()=>{a.invalidateQueries({queryKey:["pros","overview"]}),a.invalidateQueries({queryKey:["pros","reservations"]})}}),f=q({mutationFn:async t=>await D.prosCancelReservation(t),onSuccess:()=>{a.invalidateQueries({queryKey:["pros","overview"]}),a.invalidateQueries({queryKey:["pros","reservations"]})}}),m=q({mutationFn:async t=>await D.prosDeleteReservation(t),onSuccess:()=>{a.invalidateQueries({queryKey:["pros","overview"]}),a.invalidateQueries({queryKey:["pros","reservations"]})}});return{createAppointment:r.mutateAsync,markAttended:c.mutateAsync,markNoShow:l.mutateAsync,cancelAppointment:f.mutateAsync,deleteAppointment:m.mutateAsync,isCreating:r.isPending,isMarkingAttended:c.isPending,isMarkingNoShow:l.isPending,isCancelling:f.isPending||m.isPending}},Ye=()=>{const{toast:s}=Z(),{session:a}=se(),[r,c]=o.useState(!1),l=a==null?void 0:a.stylist,{appointments:f,upcomingAppointment:m,summary:t,isInitialOverviewLoading:n,overviewErrorMessage:p}=De(!!l),{createAppointment:w,markAttended:u,markNoShow:g,cancelAppointment:k,deleteAppointment:b,isMarkingAttended:i,isMarkingNoShow:x,isCancelling:v}=Ee({professionalId:l==null?void 0:l.id}),N=o.useCallback(async(h,S,C)=>{if(!S){s({title:"Error",description:"No se pudo identificar la cita",variant:"destructive"});return}try{h==="attended"?(await u(S),s({title:"Cita marcada como asistida",description:"El cliente ha sido marcado como atendido"})):h==="no-show"?(await g({appointmentId:S,reason:C}),s({title:"Cita marcada como no asistida",description:C?`Motivo: ${C}`:"El cliente no se presentó a la cita"})):h==="cancel"?(await k(S),s({title:"Cita cancelada",description:"La cita ha sido eliminada de la agenda"})):h==="reschedule"?s({title:"Reprogramación",description:"Abriremos la reprogramación pronto"}):h==="delete"&&(await b(S),s({title:"Cita eliminada",description:"La cita fue eliminada de forma permanente"}))}catch(T){s({title:"Error",description:T instanceof Error?T.message:"No se pudo completar la acción",variant:"destructive"})}},[k,b,u,g,s]),j=o.useCallback(()=>{c(!0)},[]),F=o.useCallback(h=>{c(h)},[]),M=o.useCallback(async({client:h,clientPhone:S,clientEmail:C,date:T,time:d,serviceId:L,serviceName:U,durationMinutes:H,notes:X})=>{try{const A=new Date(`${T}T${d}:00`);if(Number.isNaN(A.getTime()))throw new Error("Fecha u hora inválida");const G=A.toISOString(),Y=new Date(A.getTime()+H*60*1e3).toISOString();await w({serviceId:L,serviceName:U,startISO:G,endISO:Y,clientName:h,clientPhone:S,clientEmail:C,notes:X||void 0}),c(!1),s({title:"Cita creada exitosamente",description:`Cita para ${h} el ${new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}).format(A)} a las ${d} h`})}catch(A){s({title:"Error al crear la cita",description:A instanceof Error?A.message:"No se pudo crear la cita",variant:"destructive"})}},[w,s]);return l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mx-auto flex w-full max-w-7xl flex-col gap-6",children:e.jsxs("section",{className:"grid gap-6 xl:grid-cols-[minmax(350px,400px)_1fr]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(je,{appointment:m,isLoading:n,onAction:N}),e.jsx(pe,{summary:t,isLoading:n})]}),e.jsx(Ae,{appointments:f,summary:t,isLoading:n,errorMessage:p,onCreateAppointment:j,onAction:N,isProcessingAction:i||x||v})]})}),e.jsx(Ce,{open:r,onOpenChange:F,suggestedDate:(m==null?void 0:m.raw.start)??null,suggestedService:(m==null?void 0:m.service)??null,onConfirm:M})]}):e.jsxs("div",{className:"flex min-h-[320px] items-center justify-center text-sm text-muted-foreground",children:[e.jsx(ee,{className:"mr-2 h-5 w-5 animate-spin","aria-hidden":"true"}),"Cargando portal..."]})};export{Ye as ProsOverviewView,Ye as default};
