import{j as e}from"./ui-vendor-DjtdC3iZ.js";import{c as v,N as b,u as k,r as u,O as C}from"./react-vendor-DWrzsp0o.js";import{u as A}from"./useQuery-CdrMCFj5.js";import{c as L,e as P,B as h,L as g,f as R,u as _}from"./index-CX6e3e6v.js";import{u as O}from"./useMutation-CdoIIBws.js";import{a as j,A as M}from"./api-PPFfqhN_.js";import{u as z}from"./pro-BLrhzhxu.js";import{S as q}from"./scissors-d8NSnT0-.js";import{C as Q}from"./calendar-7ygCif2F.js";import"./index-Dbmg-Ekv.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=L("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),V=[{label:"Resumen",to:"/pros"},{label:"Agenda",to:"/pros/agenda"}],F=[{label:"Clientes",to:"/pros/clientes",soon:!0},{label:"Estadísticas",to:"/pros/estadisticas",soon:!0}],I=[...V,...F],W=({stylistDisplayName:o,onCreateAppointment:i,onLogout:l,isLogoutPending:t=!1})=>{const m=v().pathname.replace(/\/$/,"")||"/pros",c=m.startsWith("/pros")?m:"/pros";return e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/60 bg-background/95 backdrop-blur",children:e.jsxs("div",{className:"container relative flex h-16 items-center justify-between gap-4 px-4 sm:px-6",children:[e.jsxs(b,{to:"/pros",className:"flex items-center gap-2 text-xs font-semibold uppercase tracking-[0.24em] text-muted-foreground transition hover:text-foreground",children:[e.jsx(q,{className:"h-4 w-4 text-foreground","aria-hidden":"true"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:"Pelubot Pro"}),o?e.jsxs("span",{className:"hidden text-xs font-medium text-muted-foreground md:inline",children:["• ",o]}):null]}),e.jsx("nav",{className:"absolute left-1/2 hidden -translate-x-1/2 items-center gap-1 md:flex",children:I.map(a=>{const d=a.to.replace(/\/$/,"")||"/pros",s=d==="/pros"?c==="/pros":c.startsWith(d);return e.jsx(b,{to:a.to,className:P("px-4 py-2 text-sm font-medium transition-colors rounded-lg",s?"bg-secondary text-foreground shadow-sm":"text-muted-foreground hover:bg-secondary/60 hover:text-foreground"),children:a.label},a.to)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",className:"hidden h-9 items-center gap-2 rounded-md border-border/60 bg-transparent text-sm font-semibold text-foreground transition hover:bg-secondary md:inline-flex",onClick:i,children:[e.jsx(Q,{className:"h-4 w-4","aria-hidden":"true"}),"Nueva cita"]}),e.jsxs(h,{variant:"ghost",size:"sm",className:"h-9 rounded-md px-3 text-sm font-semibold text-muted-foreground transition hover:text-foreground",onClick:l,disabled:t,children:[t?e.jsx(g,{className:"mr-2 h-4 w-4 animate-spin","aria-hidden":"true"}):e.jsx(T,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),"Salir"]})]})]})})},Z=()=>{const o=v(),i=k(),{toast:l}=R(),{session:t,setSession:f,clearSession:m}=z(),c=u.useRef(!1),a=_(),d=u.useCallback(()=>{a.cancelQueries({queryKey:["pros"],exact:!1}),a.removeQueries({queryKey:["pros"],exact:!1}),m()},[m,a]),s=A({queryKey:["pros","me"],queryFn:j.prosMe,retry:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1});u.useEffect(()=>{const r=s.data;if(!r)return;const{stylist:p,session_expires_at:N}=r;(!t||t.stylist.id!==p.id||t.sessionExpiresAt!==N)&&f({stylist:p,sessionExpiresAt:N})},[s.data,t,f]),u.useEffect(()=>{const r=s.error;if(r){if(r.status===401){d();return}l({title:"No pudimos verificar tu sesión",description:r.message})}},[s.error,d,l]);const y=O({mutationFn:j.prosLogout,onSuccess:()=>{d(),l({title:"Sesión cerrada"}),i("/pros/login",{replace:!0})},onError:r=>{const p=r instanceof M?r.message:"No se pudo cerrar sesión.";l({title:"Error al cerrar sesión",description:p})}});u.useEffect(()=>{t!=null&&t.stylist&&(c.current=!1)},[t==null?void 0:t.stylist]);const w=s.isLoading&&!(t!=null&&t.stylist),n=s.error??null,x=n==null?void 0:n.status,E=(n==null?void 0:n.message)??"";if(u.useEffect(()=>{t!=null&&t.stylist||x===401&&(c.current||(c.current=!0,i("/pros/login",{replace:!0,state:{from:o.pathname.startsWith("/pros")?o.pathname:"/pros"}})))},[t==null?void 0:t.stylist,x,i,o.pathname]),!(t!=null&&t.stylist))return x===401?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-slate-950 text-white/70",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-center text-sm",children:[e.jsx(g,{className:"h-5 w-5 animate-spin","aria-hidden":"true"}),"Redirigiéndote al acceso profesional..."]})}):w?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-slate-950 text-white/70",children:e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx(g,{className:"h-5 w-5 animate-spin","aria-hidden":"true"}),"Verificando tu sesión..."]})}):n&&x!==401?e.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-center gap-4 bg-slate-950 text-center text-white/70",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold text-white",children:"No pudimos entrar al portal"}),e.jsx("p",{className:"text-sm text-white/60",children:E})]}),e.jsx(h,{variant:"outline",className:"rounded-full border-emerald-400/60 text-emerald-200 hover:bg-emerald-500/10",onClick:()=>s.refetch(),children:"Reintentar"})]}):null;const S=t.stylist.display_name??t.stylist.name??null;return e.jsxs("div",{className:"relative flex min-h-screen flex-col bg-background text-foreground",children:[e.jsx(W,{stylistDisplayName:S,onCreateAppointment:()=>i("/pros/agenda",{state:{newAppointment:!0}}),onLogout:()=>y.mutate(),isLogoutPending:y.isPending}),e.jsx("main",{className:"flex-1 py-6 sm:py-8",children:e.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:e.jsx(C,{})})})]})};export{Z as ProsShell,Z as default};
