import{j as e,c as B,P as b,f as P,h as v}from"./ui-vendor-DjtdC3iZ.js";import{r as u}from"./react-vendor-DWrzsp0o.js";import{c as q,e as j,B as p,f as U,L as G}from"./index-CX6e3e6v.js";import{u as H}from"./pro-BLrhzhxu.js";import{s as Y}from"./index-Dbmg-Ekv.js";import{B as g}from"./badge-DafbdF4t.js";import{C as h}from"./card-SJHWFEUi.js";import{I as W,S as K}from"./scroll-area-bPXHL8tR.js";import{S as x}from"./skeleton-BQs0x_V-.js";import{U as Q}from"./users-BNeOueFB.js";import{u as O}from"./useQuery-CdrMCFj5.js";import{a as J}from"./api-PPFfqhN_.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=q("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);function Z(){return Y.useSyncExternalStore(ee,()=>!0,()=>!1)}function ee(){return()=>{}}var N="Avatar",[te,Fe]=B(N),[se,k]=te(N),A=u.forwardRef((t,s)=>{const{__scopeAvatar:r,...a}=t,[i,n]=u.useState("idle");return e.jsx(se,{scope:r,imageLoadingStatus:i,onImageLoadingStatusChange:n,children:e.jsx(b.span,{...a,ref:s})})});A.displayName=N;var E="AvatarImage",I=u.forwardRef((t,s)=>{const{__scopeAvatar:r,src:a,onLoadingStatusChange:i=()=>{},...n}=t,o=k(E,r),d=re(a,n),l=P(c=>{i(c),o.onImageLoadingStatusChange(c)});return v(()=>{d!=="idle"&&l(d)},[d,l]),d==="loaded"?e.jsx(b.img,{...n,ref:s,src:a}):null});I.displayName=E;var L="AvatarFallback",_=u.forwardRef((t,s)=>{const{__scopeAvatar:r,delayMs:a,...i}=t,n=k(L,r),[o,d]=u.useState(a===void 0);return u.useEffect(()=>{if(a!==void 0){const l=window.setTimeout(()=>d(!0),a);return()=>window.clearTimeout(l)}},[a]),o&&n.imageLoadingStatus!=="loaded"?e.jsx(b.span,{...i,ref:s}):null});_.displayName=L;function y(t,s){return t?s?(t.src!==s&&(t.src=s),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function re(t,{referrerPolicy:s,crossOrigin:r}){const a=Z(),i=u.useRef(null),n=a?(i.current||(i.current=new window.Image),i.current):null,[o,d]=u.useState(()=>y(n,t));return v(()=>{d(y(n,t))},[n,t]),v(()=>{const l=f=>()=>{d(f)};if(!n)return;const c=l("loaded"),m=l("error");return n.addEventListener("load",c),n.addEventListener("error",m),s&&(n.referrerPolicy=s),typeof r=="string"&&(n.crossOrigin=r),()=>{n.removeEventListener("load",c),n.removeEventListener("error",m)}},[n,r,s]),o}var R=A,T=I,F=_;const M=u.forwardRef(({className:t,...s},r)=>e.jsx(R,{ref:r,className:j("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s}));M.displayName=R.displayName;const ae=u.forwardRef(({className:t,...s},r)=>e.jsx(T,{ref:r,className:j("aspect-square h-full w-full",t),...s}));ae.displayName=T.displayName;const D=u.forwardRef(({className:t,...s},r)=>e.jsx(F,{ref:r,className:j("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s}));D.displayName=F.displayName;const V={activo:"Activo",nuevo:"Nuevo",riesgo:"En riesgo",inactivo:"Inactivo"},z={activo:"bg-emerald-500/10 text-emerald-200 ring-emerald-400/40",nuevo:"bg-sky-500/10 text-sky-200 ring-sky-400/40",riesgo:"bg-amber-500/10 text-amber-200 ring-amber-400/40",inactivo:"bg-slate-500/10 text-slate-200 ring-slate-400/40"},oe={emerald:"border-emerald-300 bg-emerald-50 text-emerald-900",amber:"border-amber-300 bg-amber-50 text-amber-900",rose:"border-rose-300 bg-rose-50 text-rose-900"},ne=new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR",maximumFractionDigits:0}),ie=new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"short",year:"numeric"}),de=new Intl.RelativeTimeFormat("es",{numeric:"auto"}),le=t=>ne.format(t),w=t=>{if(!t)return null;const s=new Date(t);return Number.isNaN(s.getTime())?null:ie.format(s)},S=t=>{if(!t)return null;const s=new Date(t);if(Number.isNaN(s.getTime()))return null;const r=new Date;r.setHours(0,0,0,0);const a=new Date(s);a.setHours(0,0,0,0);const i=a.getTime()-r.getTime(),n=Math.round(i/(1e3*60*60*24));return de.format(n,"day")},ce=t=>t.split(/\s+/).filter(Boolean).slice(0,2).map(s=>s.charAt(0).toUpperCase()).join(""),me=({clients:t,isLoading:s,errorMessage:r,onImportClick:a,onRefreshClick:i})=>{const n=()=>s?e.jsx("div",{className:"flex h-64 items-center justify-center text-sm text-muted-foreground",children:"Cargando directorio..."}):r?e.jsxs("div",{className:"flex h-64 flex-col items-center justify-center gap-2 px-6 text-center text-sm text-destructive",children:[e.jsx(W,{className:"h-5 w-5"}),e.jsx("p",{children:r})]}):t.length===0?e.jsxs("div",{className:"flex h-64 flex-col items-center justify-center gap-3 px-6 text-center text-sm text-muted-foreground",children:[e.jsx("p",{className:"max-w-md",children:"Aún no has registrado clientes. Cuando confirmes reservas desde la agenda, aparecerán aquí automáticamente."}),e.jsx(p,{variant:"outline",className:"border-border/60",disabled:!0,children:"Crear cliente manualmente (en camino)"})]}):e.jsx(K,{className:"max-h-[520px] pr-1",children:e.jsx("div",{className:"space-y-3 p-4",children:t.map(o=>{var d,l,c,m;return e.jsxs("div",{className:"flex flex-col gap-4 rounded-2xl border border-border/50 bg-background/80 p-4 transition hover:border-border hover:bg-background",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(M,{className:"h-12 w-12 border border-border/60 bg-muted/30",children:e.jsx(D,{className:"text-sm font-medium text-foreground",children:o.initials})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("p",{className:"text-lg font-semibold text-foreground",children:o.name}),e.jsx(g,{variant:"secondary",className:`border border-transparent text-xs uppercase tracking-wide ${z[o.status]}`,children:V[o.status]}),o.tags.map(f=>e.jsx(g,{variant:"outline",className:"border-border/50 text-[11px] text-muted-foreground",children:f},f))]}),e.jsxs("div",{className:"grid gap-4 text-sm text-muted-foreground md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.12em] text-muted-foreground/70",children:"Última visita"}),e.jsx("p",{className:"font-medium text-foreground",children:o.lastVisitLabel}),o.lastVisitRelative?e.jsx("p",{className:"text-xs text-muted-foreground/80",children:o.lastVisitRelative}):null]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.12em] text-muted-foreground/70",children:"Próxima visita"}),e.jsx("p",{className:"font-medium text-foreground",children:o.upcomingLabel??"Sin cita programada"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm text-muted-foreground",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.12em] text-muted-foreground/70",children:"Histórico"}),e.jsxs("span",{className:"font-medium text-foreground",children:[o.totalVisits," visitas"]}),e.jsxs("span",{className:"text-xs text-muted-foreground/80",children:[le(o.totalSpent)," acumulados"]}),o.favoriteServices.length?e.jsxs("span",{className:"text-xs text-muted-foreground/80",children:["Favoritos: ",o.favoriteServices.join(", ")]}):null]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 border-t border-border/60 pt-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[(d=o.contact)!=null&&d.phone?e.jsx("span",{children:o.contact.phone}):null,(l=o.contact)!=null&&l.email?e.jsx("span",{children:o.contact.email}):null,!((c=o.contact)!=null&&c.phone)&&!((m=o.contact)!=null&&m.email)?e.jsx("span",{className:"text-xs text-muted-foreground/70",children:"Sin datos de contacto"}):null]}),e.jsx(p,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground",disabled:!0,children:"Abrir ficha (pronto)"})]})]},o.id)})})});return e.jsxs(h,{className:"flex flex-col overflow-hidden border border-border/60 bg-card/90 shadow-lg shadow-black/10",children:[e.jsxs("div",{className:"flex flex-col gap-3 border-b border-border/60 px-5 py-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Directorio de clientes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Explora el histórico, contacto y próximos pasos. Pronto podrás filtrar y editar cada ficha."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:i,children:"Actualizar"}),e.jsx(p,{variant:"outline",size:"sm",onClick:a,children:"Importar clientes (pronto)"})]})]}),n()]})},ue=({followUps:t,isLoading:s})=>e.jsxs(h,{className:"space-y-4 rounded-2xl border border-border/60 bg-card/90 p-5 shadow-lg shadow-black/10",children:[e.jsxs("header",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-amber-500","aria-hidden":"true"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Seguimiento recomendado"})]}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Contactos que llevan más tiempo sin visitar el salón. Podrás automatizar recordatorios muy pronto."})]}),s?e.jsxs("div",{className:"space-y-3",children:[e.jsx(x,{className:"h-16 w-full rounded-xl bg-muted/40"}),e.jsx(x,{className:"h-16 w-full rounded-xl bg-muted/40"}),e.jsx(x,{className:"h-16 w-full rounded-xl bg-muted/40"})]}):t.length===0?e.jsx("div",{className:"rounded-xl border border-dashed border-border/60 bg-muted/20 px-4 py-6 text-center text-sm text-muted-foreground",children:"No hay clientes críticos en este momento. ¡Buen trabajo manteniendo las visitas recientes!"}):e.jsx("ul",{className:"space-y-3",children:t.map(r=>e.jsxs("li",{className:"flex items-center justify-between gap-3 rounded-xl border border-border/60 bg-background/80 px-4 py-3",children:[e.jsxs("div",{className:"flex flex-col text-sm text-muted-foreground",children:[e.jsx("span",{className:"font-semibold text-foreground",children:r.name}),e.jsxs("span",{className:"text-xs text-muted-foreground/80",children:["Última visita: ",r.lastVisitLabel]}),r.lastVisitRelative?e.jsx("span",{className:"text-xs text-muted-foreground/70",children:r.lastVisitRelative}):null]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(g,{variant:"secondary",className:`border border-transparent text-xs uppercase tracking-wide ${z[r.status]}`,children:V[r.status]}),e.jsx(p,{variant:"outline",size:"sm",disabled:!0,children:"Enviar recordatorio (pronto)"})]})]},r.id))})]}),xe=new Intl.NumberFormat("es-ES"),fe=({segments:t,isLoading:s})=>e.jsxs(h,{className:"space-y-4 rounded-2xl border border-border/60 bg-card/90 p-5 shadow-lg shadow-black/10",children:[e.jsxs("header",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-primary","aria-hidden":"true"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Segmentos destacados"})]}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Agrupaciones automáticas según hábitos y valor histórico. Añadiremos filtros y acciones pronto."})]}),s?e.jsxs("div",{className:"space-y-3",children:[e.jsx(x,{className:"h-16 w-full rounded-xl bg-muted/40"}),e.jsx(x,{className:"h-16 w-full rounded-xl bg-muted/40"}),e.jsx(x,{className:"h-16 w-full rounded-xl bg-muted/40"})]}):t.length===0?e.jsx("div",{className:"rounded-xl border border-dashed border-border/60 bg-muted/20 px-4 py-6 text-center text-sm text-muted-foreground",children:"Todavía no hay segmentos automáticos. Comenzaremos a sugerirlos en cuanto registremos más visitas."}):e.jsx("ul",{className:"space-y-3",children:t.map(r=>{const a=r.accent?oe[r.accent]:"border-border text-foreground";return e.jsx("li",{className:`space-y-2 rounded-xl border bg-background/80 px-4 py-3 transition hover:border-border hover:bg-background ${a}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold uppercase tracking-wide",children:r.label}),r.description?e.jsx("p",{className:"text-xs text-muted-foreground",children:r.description}):null]}),e.jsx(g,{variant:"outline",className:"border-border/60 text-sm font-semibold",children:xe.format(r.count)})]})},r.id)})})]}),pe=new Intl.NumberFormat("es-ES"),ge=t=>[{key:"total",label:"Clientes totales",description:`${t.recurrentes} con visitas recientes`,value:t.total,accent:"text-emerald-600"},{key:"recurrentes",label:"Clientes recurrentes",description:"Última visita dentro de 90 días",value:t.recurrentes,accent:"text-sky-600"},{key:"nuevos",label:"Clientes nuevos",description:"Registrados el último trimestre",value:t.nuevos,accent:"text-indigo-600"},{key:"riesgo",label:"Clientes a recuperar",description:`${t.riesgo} en seguimiento · ${t.inactivos} inactivos`,value:t.riesgo+t.inactivos,accent:"text-amber-600"}],he=({summary:t,isLoading:s})=>{const r=ge(t);return e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-4",children:r.map(a=>e.jsxs(h,{className:"space-y-3 rounded-2xl border border-border/60 bg-card/90 p-5 shadow-lg shadow-black/10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:a.label}),e.jsx("p",{className:"text-xs text-muted-foreground/80",children:a.description})]}),s?e.jsx(x,{className:"h-8 w-1/3 rounded-lg bg-muted/40"}):e.jsx("span",{className:`text-4xl font-semibold tracking-tight ${a.accent}`,children:pe.format(a.value)})]},a.key))})},ve={total:0,nuevos:0,recurrentes:0,riesgo:0,inactivos:0},C=["emerald","amber","rose"],be=t=>{var n,o;const s=w(t.last_visit),r=S(t.last_visit),a=w(((n=t.upcoming_visit)==null?void 0:n.start)??null),i=S(((o=t.upcoming_visit)==null?void 0:o.start)??null);return{id:t.id,name:t.full_name,initials:ce(t.full_name),status:t.status,lastVisitLabel:s??"Sin visitas registradas",lastVisitRelative:r??void 0,upcomingLabel:a?i?`${a} · ${i}`:a:void 0,totalVisits:t.total_visits,totalSpent:t.total_spent_eur,favoriteServices:t.favorite_services??[],tags:t.tags??[],contact:t.phone||t.email?{phone:t.phone??void 0,email:t.email??void 0}:void 0,loyaltyScore:t.loyalty_score??void 0,notes:t.notes??void 0,raw:t}},je=t=>{var o,d,l;const s=O({queryKey:["pros","clients"],queryFn:J.prosClients,enabled:t,retry:1,refetchOnWindowFocus:!1}),r=((o=s.data)==null?void 0:o.summary)??ve,a=u.useMemo(()=>{var m;const c=((m=s.data)==null?void 0:m.segments)??[];return c.length===0?[]:c.map((f,$)=>({...f,accent:C[$%C.length]}))},[(d=s.data)==null?void 0:d.segments]),i=u.useMemo(()=>{var m;return(((m=s.data)==null?void 0:m.clients)??[]).map(be)},[(l=s.data)==null?void 0:l.clients]),n=s.error;return{summary:r,segments:a,clients:i,isLoading:s.isLoading&&!s.data,errorMessage:(n==null?void 0:n.message)??null,refetch:s.refetch}},Ne=t=>{const s=r=>{if(!r)return Number.NEGATIVE_INFINITY;const a=new Date(r);return Number.isNaN(a.getTime())?Number.NEGATIVE_INFINITY:a.getTime()};return t.filter(r=>r.status==="riesgo"||r.status==="inactivo").sort((r,a)=>s(r.raw.last_visit??null)-s(a.raw.last_visit??null)).slice(0,3)},Me=()=>{const{toast:t}=U(),{session:s}=H(),r=s==null?void 0:s.stylist,{summary:a,segments:i,clients:n,isLoading:o,errorMessage:d,refetch:l}=je(!!r),c=u.useMemo(()=>Ne(n),[n]);if(!r)return e.jsxs("div",{className:"flex min-h-[320px] items-center justify-center text-sm text-muted-foreground",children:[e.jsx(G,{className:"mr-2 h-5 w-5 animate-spin","aria-hidden":"true"}),"Cargando cartera de clientes..."]});const m=()=>{t({title:"Función en camino",description:"Estamos terminando el flujo de importación y edición de clientes. ¡Muy pronto disponible! 🛠️"})};return e.jsxs("section",{className:"mx-auto flex w-full max-w-6xl flex-col gap-6",children:[e.jsxs("header",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-semibold text-foreground",children:"Clientes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Visualiza tus contactos, detecta oportunidades y prepara campañas de fidelización."})]}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>l(),children:"Actualizar"})]}),e.jsx(he,{summary:a,isLoading:o}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[minmax(0,1.6fr)_minmax(0,1fr)]",children:[e.jsx(me,{clients:n,isLoading:o,errorMessage:d,onImportClick:m,onRefreshClick:()=>{l()}}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(fe,{segments:i,isLoading:o}),e.jsx(ue,{followUps:c,isLoading:o}),e.jsxs("div",{className:"rounded-2xl border border-dashed border-border/60 bg-card/70 p-5 text-sm text-muted-foreground",children:[e.jsx("p",{className:"font-medium text-foreground",children:"¿Qué viene después?"}),e.jsxs("ul",{className:"mt-3 list-disc space-y-2 pl-5",children:[e.jsx("li",{children:"Edición de fichas con notas y etiquetas personalizadas."}),e.jsx("li",{children:"Filtros avanzados (ticket medio, servicios favoritos, última visita)."}),e.jsx("li",{children:"Automatizaciones para recordatorios por WhatsApp y correo."})]}),e.jsx("button",{type:"button",onClick:m,className:"mt-4 inline-flex items-center rounded-full border border-border/60 px-4 py-2 text-xs font-medium uppercase tracking-wide text-muted-foreground transition hover:bg-muted/30 hover:text-foreground",children:"Avisarme cuando esté listo"})]})]})]})]})};export{Me as ProsClientsView,Me as default};
