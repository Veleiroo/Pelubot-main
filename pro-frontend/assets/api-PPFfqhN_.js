var q=Object.defineProperty;var x=(e,t,s)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var T=(e,t,s)=>x(e,typeof t!="symbol"?t+"":t,s);const O=[{id:"corte_cabello",name:"Corte de cabello clásico",duration_min:30,price_eur:15},{id:"arreglo_barba",name:"Arreglo de barba premium",duration_min:25,price_eur:12},{id:"corte_jubilado",name:"Corte Jubilado",duration_min:35,price_eur:13}],Y=[{id:"ana",name:"Ana Fernández"},{id:"luis",name:"Luis Ortega"},{id:"marcos",name:"Marcos Vidal"}],K=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,I=new Date,j=new Date(I.getFullYear(),I.getMonth(),I.getDate()+2),M=K(j),W=`${M}T10:00:00+02:00`;class b extends Error{constructor(s,a,n){super(a);T(this,"status");T(this,"detail");this.name="MockHttpError",this.status=s,this.detail=n}}const $={id:"marina",name:"Marina García",display_name:"Marina",services:["corte_cabello","arreglo_barba"],email:"marina@example.com",phone:"+34 600 123 456",calendar_id:null,use_gcal_busy:!1},A=()=>({stylist:$,session_expires_at:new Date(Date.now()+1e3*60*60).toISOString()});let y=!1;const C=e=>JSON.parse(JSON.stringify(e)),R=e=>Y[0],X=()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),9,30,0),s=o=>new Date(t.getTime()+o*6e4),a=[{id:"apt-201",start:s(0).toISOString(),end:s(45).toISOString(),service_id:"corte_cabello",service_name:"Corte y peinado",status:"confirmada",client_name:"Laura Pérez",client_phone:"+34 612 345 678",last_visit:"2025-09-12",notes:"Prefiere acabado con ondas suaves."},{id:"apt-202",start:s(120).toISOString(),end:s(180).toISOString(),service_id:"coloracion",service_name:"Coloración parcial",status:"confirmada",client_name:"Marta López"},{id:"apt-203",start:s(240).toISOString(),end:s(300).toISOString(),service_id:"tratamiento",service_name:"Tratamiento hidratante",status:"asistida",client_name:"Andrea Vidal"},{id:"apt-204",start:s(360).toISOString(),end:s(420).toISOString(),service_id:"recogido",service_name:"Recogido evento",status:"no_asistida",client_name:"Sara Núñez",notes:"No llegó a la cita"},{id:"apt-205",start:s(480).toISOString(),end:s(540).toISOString(),service_id:"corte_cabello",service_name:"Corte básico",status:"cancelada",client_name:"Isabel Ruiz"}],n={total:a.length,confirmadas:a.filter(o=>o.status==="confirmada").length,asistidas:a.filter(o=>o.status==="asistida").length,no_asistidas:a.filter(o=>o.status==="no_asistida").length,canceladas:a.filter(o=>o.status==="cancelada").length},g=e.getTime(),h=a.find(o=>o.status!=="cancelada"&&new Date(o.start).getTime()>=g)??a.find(o=>o.status!=="cancelada")??null;return{date:K(e),timezone:"Europe/Madrid",summary:n,upcoming:h,appointments:a}},P=(e,t,s)=>Math.min(Math.max(e,t),s),V=e=>{const t=new Date,s=P(Math.round((e==null?void 0:e.daysAhead)??30),7,90),a=P(Math.round((e==null?void 0:e.includePastMinutes)??60*24*30),0,60*24*90),n=P(Math.ceil(a/(60*24)),1,30),h=n+s+1,o=new Date(t.getFullYear(),t.getMonth(),t.getDate()-n);return{reservations:Array.from({length:h}).flatMap((_,r)=>{const c=new Date(o.getFullYear(),o.getMonth(),o.getDate()+r);return[9,11,14,17].slice(0,r%3+2).map((w,d)=>{const m=new Date(c.getFullYear(),c.getMonth(),c.getDate(),w,d%2===0?0:30,0),S=new Date(m.getTime()+45*6e4),i=O[(r+d)%O.length];return{id:`res-${`${c.getMonth()+1}-${c.getDate()}-${d}`}`,service_id:i.id,service_name:i.name,professional_id:$.id,start:m.toISOString(),end:S.toISOString(),customer_name:`Cliente ${r+d+1}`,customer_email:`cliente${r+d+1}@pelubot.mock`,customer_phone:"+34 600 000 000",notes:d%3===0?"Confirmar preferencia de estilo.":void 0,created_at:new Date(m.getTime()-5*6e4).toISOString(),updated_at:new Date(m.getTime()-2*6e4).toISOString()}})})}};let E=null;const F=()=>(E||(E=V({daysAhead:120,includePastMinutes:60*24*60}).reservations),E),Q=e=>O.find(t=>t.id===e),Z=()=>{const e=new Date;e.setDate(e.getDate()+5),e.setHours(11,30,0,0);const t=[{id:"cli-201",full_name:"Laura Pérez",first_visit:"2023-06-18",last_visit:"2025-09-12",upcoming_visit:{appointment_id:"apt-302",start:e.toISOString(),service_name:"Coloración completa"},total_visits:18,total_spent_eur:845,phone:"+34 612 345 678",email:"laura@example.com",favorite_services:["Coloración","Tratamiento hidratante"],tags:["VIP","Color"],status:"activo",loyalty_score:92},{id:"cli-202",full_name:"Marta López",first_visit:"2024-01-09",last_visit:"2025-08-28",total_visits:6,total_spent_eur:210,phone:"+34 698 221 430",favorite_services:["Peinado evento"],tags:["Eventos"],status:"activo",loyalty_score:74},{id:"cli-203",full_name:"Andrea Vidal",first_visit:"2023-11-14",last_visit:"2025-09-01",total_visits:9,total_spent_eur:325,favorite_services:["Tratamiento hidratante"],status:"nuevo",loyalty_score:61},{id:"cli-204",full_name:"Sara Núñez",first_visit:"2022-04-02",last_visit:"2024-12-10",total_visits:3,total_spent_eur:120,phone:"+34 677 550 102",tags:["Decoloración"],status:"riesgo",loyalty_score:35},{id:"cli-205",full_name:"Daniela Gómez",first_visit:"2021-09-23",last_visit:"2023-11-18",total_visits:5,total_spent_eur:165,status:"inactivo",loyalty_score:20,notes:"Mudanza reciente, revisar si sigue en la ciudad."}],s={total:t.length,nuevos:t.filter(n=>n.status==="nuevo").length,recurrentes:t.filter(n=>n.status==="activo").length,riesgo:t.filter(n=>n.status==="riesgo").length,inactivos:t.filter(n=>n.status==="inactivo").length},a=[{id:"vip",label:"VIP",count:t.filter(n=>(n.loyalty_score??0)>=80).length,trend:"up",description:"Ticket medio superior a 60€ y visitas frecuentes."},{id:"eventos",label:"Eventos",count:t.filter(n=>{var g;return(g=n.tags)==null?void 0:g.includes("Eventos")}).length,trend:"steady",description:"Visitan principalmente para peinados y recogidos especiales."},{id:"recuperar",label:"Recuperar",count:t.filter(n=>n.status==="riesgo"||n.status==="inactivo").length,trend:"down",description:"Más de 90 días sin visita. Acciones de reactivación sugeridas."}];return{summary:s,segments:a,clients:t}},ee=()=>{var h;const e=new Date,t=Array.from({length:6}).map((o,l)=>{const _=new Date(e.getFullYear(),e.getMonth()-(5-l),1),r=_.toLocaleDateString("es-ES",{month:"short"}),c=`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}`,w=3200+l*180+Math.sin(l/2.5)*240,d=Math.max(10,Math.round(45+Math.cos(l/1.6)*5));return{period:c,label:r.charAt(0).toUpperCase()+r.slice(1),revenue_eur:Math.round(w),appointments:d}}),s={total_revenue_eur:((h=t[5])==null?void 0:h.revenue_eur)??0,revenue_change_pct:12.5,avg_ticket_eur:68.4,avg_ticket_change_pct:4.2,repeat_rate_pct:62,repeat_rate_change_pct:3.5,new_clients:14,new_clients_change_pct:-8.4},a=[{service_id:"corte_cabello",service_name:"Corte de cabello",total_appointments:38,total_revenue_eur:1230,growth_pct:9.8},{service_id:"coloracion",service_name:"Coloración completa",total_appointments:21,total_revenue_eur:1520,growth_pct:4.3},{service_id:"tratamiento",service_name:"Tratamiento hidratante",total_appointments:17,total_revenue_eur:890,growth_pct:-3.1}],n=[{id:"active-30",label:"Activas (<30 días)",count:42,share_pct:54.3,trend:"up",description:"Clientas que visitaron el salón en el último mes."},{id:"risk-90",label:"En seguimiento (30-90 días)",count:18,share_pct:23.1,trend:"steady",description:"Recomendada una campaña de recordatorio."},{id:"recover-90+",label:"Recuperar (>90 días)",count:17,share_pct:22.6,trend:"down",description:"Contacta con beneficios especiales para su retorno."}],g=[{id:"upsell-color",title:"Activa un pack de coloración para clientas frecuentes",description:"Las reservas de coloración crecieron 4,3% este mes. Ofrece un paquete de mantenimiento para subir el ticket medio.",priority:"medium"},{id:"recover-vip",title:"Recupera clientas VIP con bono de cortes",description:"17 clientas llevan más de 90 días sin visitarte. Un bono con descuento limitado puede acelerar su regreso.",priority:"high"},{id:"nps-survey",title:"Lanza encuesta NPS post servicio",description:"Con una repetición del 62%, medir satisfacción te ayudará a identificar mejoras rápidas.",priority:"low"}];return{generated_at:new Date().toISOString(),summary:s,revenue_series:t,top_services:a,retention:n,insights:g}},L=e=>{if(!e)return;const t=Number(e);return Number.isFinite(t)?t:void 0};function te(e,t){var h;const s=((t==null?void 0:t.method)??"GET").toUpperCase(),a=t!=null&&t.body?se(t.body):void 0,n=new URL(e,"https://mock.pelubot"),g=n.pathname;switch(g){case"/services":if(s==="GET")return C(O);break;case"/professionals":if(s==="GET")return C(Y);break;case"/slots/days":if(s==="POST")return{service_id:p(a,"service_id")??O[0].id,start:p(a,"start")??M,end:p(a,"end")??M,professional_id:p(a,"professional_id")??((h=R(p(a,"service_id")))==null?void 0:h.id)??null,available_days:[M]};break;case"/slots":if(s==="POST")return{service_id:p(a,"service_id")??O[0].id,date:p(a,"date_str")??M,professional_id:p(a,"professional_id")??R().id,slots:[W]};break;case"/reservations":if(s==="POST"){const o=`mock-${Date.now()}`,l=p(a,"service_id")??O[0].id,_=Q(l)??O[0],r=p(a,"professional_id")??$.id,c=p(a,"start")??new Date().toISOString(),v=new Date(c),w=((_==null?void 0:_.duration_min)??45)*6e4,d=new Date(v.getTime()+w).toISOString(),m=F();return m.push({id:o,service_id:l,service_name:(_==null?void 0:_.name)??l,professional_id:r,start:c,end:d,customer_name:p(a,"customer_name")??"Cliente mock",customer_email:p(a,"customer_email"),customer_phone:p(a,"customer_phone"),notes:p(a,"notes"),created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),m.sort((S,i)=>new Date(S.start).getTime()-new Date(i.start).getTime()),{ok:!0,message:`Reserva creada en modo mock. ID: ${o}`,reservation_id:o,google_event_id:null}}break;case"/pros/me":if(s==="GET"){if(!y)throw new b(401,"No active session","No active session (mock)");return A()}break;case"/pros/login":if(s==="POST")return y=!0,A();break;case"/pros/logout":if(s==="POST")return y=!1,{ok:!0,message:"Sesión cerrada (mock)"};break;case"/pros/overview":if(s==="GET"){if(!y)throw new b(401,"No active session","No active session (mock)");return X()}break;case"/pros/reservations":if(s==="GET"){if(!y)throw new b(401,"No active session","No active session (mock)");const o=L(n.searchParams.get("days_ahead")),l=L(n.searchParams.get("include_past_minutes"));return V({daysAhead:o,includePastMinutes:l})}break;case"/pros/clients":if(s==="GET"){if(!y)throw new b(401,"No active session","No active session (mock)");return Z()}break;case"/pros/stats":if(s==="GET"){if(!y)throw new b(401,"No active session","No active session (mock)");return ee()}break}if(g.startsWith("/pros/reservations/")){if(!y)throw new b(401,"No active session","No active session (mock)");const o=g.split("/").filter(Boolean);if(o.length>=4){const l=o[2],_=o[3],r=F(),c=r.findIndex(v=>v.id===l);if(c===-1)throw new b(404,"Reservation not found","Reservation not found (mock)");if(s==="POST"&&_==="cancel")return r.splice(c,1),{ok:!0,message:`Reserva ${l} cancelada (mock).`};if(s==="POST"&&_==="reschedule"){const v=r[c],w=(()=>{const i=new Date(v.start),f=v.end?new Date(v.end):new Date(i.getTime()+45*6e4);return Math.max(45*6e4,f.getTime()-i.getTime())})();let d=new Date(v.start);if(a&&typeof a.new_start=="string"){const i=new Date(String(a.new_start));Number.isNaN(i.getTime())||(d=i)}else{if(a&&typeof a.new_date=="string"){const i=a.new_date.split("-").map(f=>Number.parseInt(f,10));i.length===3&&i.every(f=>Number.isFinite(f))&&d.setFullYear(i[0],i[1]-1,i[2])}if(a&&typeof a.new_time=="string"){const i=a.new_time.split(":").map(f=>Number.parseInt(f,10));i.length>=2&&Number.isFinite(i[0])&&d.setHours(i[0],Number.isFinite(i[1])?i[1]:0,0,0)}}const m=d.toISOString(),S=new Date(d.getTime()+w).toISOString();return r[c]={...v,start:m,end:S,updated_at:new Date().toISOString()},r.sort((i,f)=>new Date(i.start).getTime()-new Date(f.start).getTime()),{ok:!0,message:`Reserva ${l} reprogramada (mock).`,reservation_id:l,start:m,end:S}}}}}function se(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return}}function p(e,t){if(e&&typeof e[t]=="string")return String(e[t])}const N={},z=(()=>{const e="http://127.0.0.1:8776".trim();if(e)return e.replace(/\/$/,"");const t=String((N==null?void 0:N.VITE_API_BASE_PATH)??"").trim(),s=t?t.startsWith("/")?t:`/${t}`:"";if(typeof window<"u"){const a=window.location.origin.replace(/\/$/,"");return s?`${a}${s}`.replace(/\/$/,""):(console.warn("VITE_API_BASE_URL no definido; usando origen actual"),"")}return s||""})(),D=/^(1|true|yes|y)$/i.test("true"),B="force".trim().toLowerCase(),ae=["0","false","off","no","n"].includes(B)?"off":["force","always","mock"].includes(B)?"force":"auto",re=!1,U=ae==="force",J=U||re,G="changeme".trim();class H extends Error{constructor(s,a){super(s);T(this,"status");T(this,"detail");T(this,"requestId");T(this,"rawBody");this.name="ApiError",this.status=a.status,this.detail=a.detail,this.requestId=a.requestId,this.rawBody=a.rawBody}}async function u(e,t){const s={"Content-Type":"application/json",...(t==null?void 0:t.headers)??{}};G&&!s["X-API-Key"]&&(s["X-API-Key"]=G);const a=`${z}${e}`,n=performance.now();D&&console.debug("HTTP",(t==null?void 0:t.method)||"GET",a,t!=null&&t.body?JSON.parse(String(t.body)):void 0);const g=new AbortController,h=setTimeout(()=>g.abort(),12e3),o=async()=>{const r=a||e,c=await fetch(r,{headers:s,signal:g.signal,credentials:(t==null?void 0:t.credentials)??"include",...t}),v=Math.round(performance.now()-n);if(!c.ok){let d="",m;try{d=await c.text();try{const k=JSON.parse(d);k&&typeof k=="object"&&(m=k.detail??k.message??void 0)}catch{}}catch{}const S=c.headers.get("X-Request-ID")||void 0,i=`HTTP ${c.status}${S?` [rid=${S}]`:""}`,f=m&&String(m)||(d?`${i}: ${d.slice(0,200)}`:i);throw D&&console.warn("HTTP ERR",c.status,r,`${v}ms`,{detail:m,rid:S,text:d.slice(0,200)}),new H(f,{status:c.status,detail:m?String(m):void 0,requestId:S,rawBody:d||void 0})}const w=await c.json();return D&&console.debug("HTTP OK",200,r,`${v}ms`,w),w},l=()=>{try{return te(e,t)}catch(r){throw r instanceof b?new H(r.message,{status:r.status,detail:r.detail}):r}},_=J&&(U||!z);try{if(_){const r=l();if(r!==void 0)return D&&console.info("HTTP MOCK (sin BASE)",e,r),r}try{return await o()}catch(r){if(J){const c=l();if(c!==void 0)return D&&console.info("HTTP MOCK fallback",e,r),c}throw r}}finally{clearTimeout(h)}}const ne={getServices:()=>u("/services"),getProfessionals:()=>u("/professionals"),getSlots:(e,t)=>u("/slots",{method:"POST",body:JSON.stringify({service_id:e.service_id,date_str:e.date,professional_id:e.professional_id??void 0,use_gcal:e.use_gcal??void 0}),signal:t==null?void 0:t.signal}),createReservation:e=>u("/reservations",{method:"POST",body:JSON.stringify(e)}),getDaysAvailability:(e,t)=>u("/slots/days",{method:"POST",body:JSON.stringify({service_id:e.service_id,start:e.start,end:e.end,professional_id:e.professional_id??void 0,use_gcal:e.use_gcal??void 0}),signal:t==null?void 0:t.signal}),prosLogin:e=>u("/pros/login",{method:"POST",body:JSON.stringify(e)}),prosLogout:()=>u("/pros/logout",{method:"POST"}),prosMe:()=>u("/pros/me"),prosOverview:()=>u("/pros/overview"),prosCreateReservation:e=>u("/pros/reservations",{method:"POST",body:JSON.stringify(e)}),prosReservations:e=>{const t=new URLSearchParams;typeof(e==null?void 0:e.daysAhead)=="number"&&t.set("days_ahead",String(Math.max(1,Math.round(e.daysAhead)))),typeof(e==null?void 0:e.includePastMinutes)=="number"&&t.set("include_past_minutes",String(Math.max(0,Math.round(e.includePastMinutes))));const s=t.toString(),a=s?`/pros/reservations?${s}`:"/pros/reservations";return u(a)},prosCancelReservation:e=>u(`/pros/reservations/${e}/cancel`,{method:"POST"}),prosDeleteReservation:e=>u(`/pros/reservations/${e}`,{method:"DELETE"}),prosRescheduleReservation:(e,t)=>u(`/pros/reservations/${e}/reschedule`,{method:"POST",body:JSON.stringify(t)}),prosMarkAttended:e=>u(`/pros/reservations/${e}/mark-attended`,{method:"POST"}),prosMarkNoShow:(e,t)=>u(`/pros/reservations/${e}/mark-no-show`,{method:"POST",body:t?JSON.stringify({reason:t}):void 0}),prosClients:()=>u("/pros/clients"),prosStats:()=>u("/pros/stats")};export{H as A,ne as a};
